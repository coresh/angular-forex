"use strict";angular.module("supercrabtree.Forex",[]).provider("Forex",function(){function i(e,t,n,r,i,o){this.code=e;this.symbol=t;this.precision=s(n)?n:2;this.decimal=r||".";this.thousands=i||",";this.post=o||!1;this.rate=1}function s(e){return!isNaN(e)&&parseInt(e)===e}function o(e,r,s,o,a,f){t.all.push(e);n.base=new i(e,r,s,o,a,f);u(e,r,s,o,a,f);return this}function u(e,t,r,s,o,u){if(!n.base)throw{message:"You must call ForexProvider.addBaseCurrency before calling ForexProvider.addCurrency"};n.all[e]=new i(e,t,r,s,o,u);return this}function a(t){if(!e){t&&(r=t);return}n.current=n.all[t]}function f(){var e=0;for(var t in n.all)e++;return e}function l(e){if(f()>1){var t=p();e.jsonp(t).success(c).error(h)}}function c(i){e.currencies=!0;d(i);for(var s in n.all)t.all.indexOf(s)===-1&&t.all.push(s);r&&a(r)}function h(e){console.warn("Forex could not get conversion rates, defaulting to using the base currency")}function p(){var e="";for(var t in n.all){var r=n.all[t];e+=encodeURIComponent("s="+n.base.code+t+"=X&")}var i="http://query.yahooapis.com/v1/public/yql?q=select%20rate%2Cname%20from%20csv%20where%20url%3D'http%3A%2F%2Fdownload.finance.yahoo.com%2Fd%2Fquotes%3F",s="f%3Dl1n'%20and%20columns%3D'rate%2Cname'&format=json&callback=JSON_CALLBACK";return i+e+s}function d(e){var t=e.query.results.row;for(var r=0;r<t.length;r++){var i=t[r],s=i.name.replace(n.base.code+" to ","");n.all[s].rate=parseFloat(i.rate)}}var e={currencies:!1},t={all:[]},n={all:{},current:null,base:null},r="";return{addBaseCurrency:o,addCurrency:u,setCurrency:a,$get:function(r){l(r);return{setCurrency:function(e){a(e)},currencyCodes:t,currencies:n,isReady:e}}}}).filter("forex",["Forex",function(e){return function(t,n){var r;if(!e.isReady.currencies)r=e.currencies.base;else if(n){if(!e.currencies.all[n]){console.error("Forex: The currency code you have used does not exist");return t}r=e.currencies.all[n]}else r=e.currencies.current;var i=t,s=t<0;s&&(i=Math.abs(i));i=(i*r.rate).toFixed(r.precision);var o=i.split(".");i=o[0].replace(/(\d{1,3})(?=(\d{3})+(?!\d))/g,"$1"+r.thousands);r.precision&&(i+=r.decimal+o[1]);r.post?i+=r.symbol:i=r.symbol+i;s&&(i="-"+i);return i}}]);